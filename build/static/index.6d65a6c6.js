import{d as re,a as m,a7 as ce,r as ue,b as O,o as i,c as R,e as f,j as v,q as B,O as C,P as I,I as F,n as de,u as M,t as ie,Q as he,R as P,g as b,k as $,a4 as fe,S as pe,_ as me}from"./index.1e787b1d.js";import{R as ge}from"./index.57eaae27.js";import{F as Ee,a as we,b as Fe,c as De}from"./index.16323184.js";import{u as ye,C as Re,S as ve,a as Ce,V as _e,R as Oe,b as Ie,j as be,r as Ne,d as ke,e as Ae,c as Se,k as Be,l as Me,m as Pe,f as Te,n as $e,o as Ue,p as Le}from"./index.7c74626f.js";import{M as d,D as N}from"./request.531db72e.js";const Ve={class:"records"},je={class:"fns"},xe={class:"top-options"},qe={class:"select-suitations"},ze={class:"resource-content"},Qe=["onClick"],Ge={class:"outer-container"},He={class:"content"},Je=re({__name:"index",props:{sId:null},setup(k){const g=k,A=ye(),h=m([]),E=m([]),w=m([]),r=m([]),c=m([]),u=m([]),p=m({show:!1,type:"r"}),T=ce(()=>r.reduce((t,e)=>t+Number(e),0)+c.reduce((t,e)=>t+Number(e),0)+u.reduce((t,e)=>t+Number(e),0)),l=m({show:!1,id:0,type:"r",title:""}),n=m({show:!1,id:0,type:"r",initName:"",order:0}),S=ue(!1),y=async()=>{h.splice(0,h.length),E.splice(0,E.length),w.splice(0,w.length),r.splice(0,r.length),c.splice(0,c.length),u.splice(0,u.length);try{const t=await be(g.sId);h.push(...t.data.data.resources),E.push(...t.data.data.folders),w.push(...t.data.data.files),r.push(...new Array(t.data.data.resources.length).fill(!1)),c.push(...new Array(t.data.data.folders.length).fill(!1)),u.push(...new Array(t.data.data.files.length).fill(!1))}catch(t){console.log("getResourceContent error",t)}};y();const _=A.getRecordFromMap({sId:g.sId}),U=(t,e)=>{const s={name:pe,params:{sId:t}};A.addRecordToMap({sId:t},[..._,{path:s,text:e}]),$.push(s)},L=(t,e)=>{const s={name:fe,params:{foId:t,sId:g.sId}};A.addRecordToMap({foId:t,sId:g.sId},[..._,{path:s,text:e}]),$.push(s)},V=()=>{T.value!==r.length+c.length+u.length?(r.forEach((t,e)=>{r[e]=!0}),c.forEach((t,e)=>{c[e]=!0}),u.forEach((t,e)=>{u[e]=!0})):(r.forEach((t,e)=>{r[e]=!1}),c.forEach((t,e)=>{c[e]=!1}),u.forEach((t,e)=>{u[e]=!1}))},j=t=>()=>{r[t]=!r[t]},x=()=>{r.forEach((t,e)=>{r[e]=!1}),c.forEach((t,e)=>{c[e]=!1}),u.forEach((t,e)=>{u[e]=!1})},q=t=>{d("error","web\u7AEF\u6682\u4E0D\u652F\u6301\u4E0B\u8F7D\u8D44\u6E90\u529F\u80FD")},z=(t,e)=>{N("warning",{title:"\u786E\u5B9A\u5220\u9664\u5417",content:"10\u5929\u5185\u53EF\u4EE5\u4ECE\u56DE\u6536\u7AD9\u64A4\u9500",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{Te(t).then(s=>{h.splice(e,1),d("success",s.data.msg)}).catch(s=>{console.log("delete err",s)})}})},Q=t=>{Ne(n.id,t).then(e=>{h[n.order].sName=t,d("success",e.data.msg)}).catch(e=>{}).finally(()=>{n.show=!1})},G=async(t,e)=>{try{const s=await ke(t);s.data.msg==="\u516C\u5F00\u6210\u529F"?h[e].isPublic=2:h[e].isPublic=1,d("success",s.data.msg)}catch(s){console.log("resourceLock error",s)}},H=async(t,e)=>{try{const s=await Ae(t);s.data.msg==="\u6536\u85CF\u6210\u529F"?h[e].isCollection=!0:h[e].isCollection=!1,d("success",s.data.msg)}catch(s){console.log("resourceCollect error",s)}},J=t=>{Se(g.sId,t).then(e=>{e.data.code=="200"&&(d("info",e.data.msg),y())}).catch(e=>{console.log("createResource error",e)}).finally(()=>{p.show=!1})},K=t=>{Be(g.sId,1,t).then(e=>{e.data.code=="200"&&(d("info",e.data.msg),y())}).catch(e=>{console.log("createFolder error",e)}).finally(()=>{p.show=!1})},W=()=>{d("error","web\u7AEF\u6682\u65F6\u4E0D\u652F\u6301\u4E0B\u8F7D\u529F\u80FD")},X=(t,e)=>{N("warning",{title:"\u786E\u5B9A\u5220\u9664\u5417",content:"10\u5929\u5185\u53EF\u4EE5\u4ECE\u56DE\u6536\u7AD9\u64A4\u9500",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{$e(t).then(s=>{E.splice(e,1),d("success",s.data.msg)}).catch(s=>{console.log("delete err",s)})}})},Y=t=>{Me(n.id,t).then(e=>{E[n.order].foName=t,d("success",e.data.msg)}).catch(e=>{console.log("folderRename error",e)}).finally(()=>{n.show=!1})},Z=()=>{d("error","web\u7AEF\u6682\u65F6\u4E0D\u652F\u6301\u4E0B\u8F7D")},ee=t=>{Pe(n.id,t).then(e=>{w[n.order].fileName=t,d("success",e.data.msg)}).catch(e=>{console.log("fileRename error",e)}).finally(()=>{n.show=!1})},te=(t,e)=>{N("warning",{title:"\u786E\u5B9A\u5220\u9664\u5417",content:"10\u5929\u5185\u53EF\u4EE5\u4ECE\u56DE\u6536\u7AD9\u64A4\u9500",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{Ue(t).then(s=>{w.splice(e,1),d("success",s.data.msg)}).catch(s=>{console.log("fileDelete err",s)})}})},se=t=>{N("warning",{title:"\u4E0A\u4F20\u63D0\u9192",content:"\u786E\u5B9A\u4E0A\u4F20?",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{const e=[];for(let s=0;s<t.length;s++)e.push(Le(t[s],1,g.sId));Promise.all(e).then(s=>{d("success",s[0].data.msg),y()}).catch(s=>{console.log("Promise.all uploadFiles error",s)})}})},oe=t=>{const[e,s]=Fe(t);De(g.sId,1,e,s).then(y)};return(t,e)=>{const s=O("router-link"),ne=O("n-breadcrumb-item"),ae=O("n-breadcrumb"),le=O("svg-icon");return i(),R(C,null,[f("header",null,[f("div",Ve,[v(ae,{separator:">"},{default:B(()=>[(i(!0),R(C,null,I(M(_),(o,a)=>(i(),F(ne,{key:a},{default:B(()=>[v(s,{to:o.path,class:de(["breadcrumb-route",[a===M(_).length-1?"active":"no-active"]])},{default:B(()=>[f("span",null,ie(o.text),1)]),_:2},1032,["to","class"])]),_:2},1024))),128))]),_:1})]),f("div",je,[v(le,{className:"icon-sousuo",class:"search-icon",onClick:e[0]||(e[0]=o=>S.value=!0)}),v(Re,{type:"resource",onOnNewFolder:e[1]||(e[1]=()=>{p.type="f",p.show=!0}),onOnNewResource:e[2]||(e[2]=()=>{p.type="r",p.show=!0}),onOnUploadFile:se,onOnUploadFolder:oe})])]),f("main",null,[f("div",xe,[f("div",qe,[v(ve,{show:h.length+E.length+w.length!==0,"all-count":h.length+E.length+w.length,"select-count":M(T),"handle-select":V},null,8,["show","all-count","select-count"])])]),f("div",ze,[f("div",{class:"absolute",onClick:he(x,["stop"])},[f("div",Ge,[f("div",He,[(i(!0),R(C,null,I(h,(o,a)=>(i(),F(ge,P({key:o.sId},o,{hasSelect:r[a],handleSelect:j(a),onClick:D=>U(o.sId,o.sName),onOnDownload:q,onOnDetails:()=>{l.show=!0,l.id=o.sId,l.type="r",l.title=o.sName},onOnDelete:D=>z(o.sId,a),onOnRename:()=>{n.show=!0,n.type="r",n.id=o.sId,n.initName=o.sName,n.order=a},onOnPublic:D=>G(o.sId,a),onOnCollect:D=>H(o.sId,a)}),null,16,["hasSelect","handleSelect","onClick","onOnDetails","onOnDelete","onOnRename","onOnPublic","onOnCollect"]))),128)),(i(!0),R(C,null,I(E,(o,a)=>(i(),F(Ee,P({key:o.foId},o,{"change-able":k.sId!==0,"has-select":c[a],"handle-select":()=>{c[a]=!c[a]},onClick:D=>L(o.foId,o.foName),onOnDownload:W,onOnDelete:D=>X(o.foId,a),onOnRename:()=>{n.show=!0,n.type="f",n.id=o.foId,n.initName=o.foName,n.order=a},onOnDetails:()=>{l.show=!0,l.id=o.foId,l.type="f",l.title=o.foName}}),null,16,["change-able","has-select","handle-select","onClick","onOnDelete","onOnRename","onOnDetails"]))),128)),(i(!0),R(C,null,I(w,(o,a)=>(i(),F(we,P({key:o.fId},o,{"change-able":k.sId!==0,"has-select":u[a],"handle-select":()=>{u[a]=!u[a]},onOnDownload:Z,onOnRename:()=>{n.show=!0,n.type="file",n.id=o.fId,n.initName=o.fileName,n.order=a},onOnDetails:()=>{l.show=!0,l.id=o.fId,l.type="file",l.title=o.fileName},onOnDelete:D=>te(o.fId,a)}),null,16,["change-able","has-select","handle-select","onOnRename","onOnDetails","onOnDelete"]))),128))])])],8,Qe)])]),p.show?(i(),F(Ce,{key:0,type:p.type,"onUpdate:show":e[3]||(e[3]=o=>p.show=!1),onCreateResource:J,onCreateFolder:K},null,8,["type"])):b("",!0),l.show?(i(),F(_e,{key:1,id:l.id,type:l.type,title:l.title,"onUpdate:show":e[4]||(e[4]=o=>l.show=!1)},null,8,["id","type","title"])):b("",!0),n.show?(i(),F(Oe,{key:2,"init-name":n.initName,type:n.type,"onUpdate:show":e[5]||(e[5]=o=>n.show=!1),onResourceRename:Q,onFolderRename:Y,onFileRename:ee},null,8,["init-name","type"])):b("",!0),S.value?(i(),F(Ie,{key:3,"onUpdate:show":e[6]||(e[6]=o=>S.value=!1)})):b("",!0)],64)}}});const et=me(Je,[["__scopeId","data-v-21eb1e71"]]);export{et as default};
