import{F as X,a as Y,b as Z,c as ee}from"./index.16323184.js";import{u as te,C as oe,S as se,a as ne,V as ae,R as le,b as re,q as ce,c as ue,k as de,l as ie,m as he,n as fe,o as pe,p as me}from"./index.7c74626f.js";import{d as ge,a as g,a7 as Fe,r as we,b as v,o as u,c as E,e as d,j as D,q as C,O as y,P as N,I as F,n as De,u as O,t as ve,R as M,g as _,a4 as Ee,k as ye,_ as _e}from"./index.1e787b1d.js";import{M as h,D as k}from"./request.531db72e.js";const Ie={class:"records"},Re={class:"fns"},be={class:"top-options"},Ce={class:"select-suitations"},Ne={class:"resource-content"},Oe={class:"outer-container"},ke={class:"content"},Ae=ge({__name:"index",props:{sId:null,foId:null},setup(I){const i=I,A=te(),f=g([]),p=g([]),a=g([]),l=g([]),m=g({show:!1,type:"r"}),B=Fe(()=>a.reduce((t,e)=>t+Number(e),0)+l.reduce((t,e)=>t+Number(e),0)),c=g({show:!1,id:0,type:"r",title:""}),n=g({show:!1,id:0,type:"r",initName:"",order:0}),R=we(!1),w=async()=>{f.splice(0,f.length),p.splice(0,p.length),a.splice(0,a.length),l.splice(0,l.length);try{const t=await ce(i.foId);f.push(...t.data.data.folders),p.push(...t.data.data.files),a.push(...new Array(t.data.data.folders.length).fill(!1)),l.push(...new Array(t.data.data.files.length).fill(!1))}catch(t){console.log("getResourceContent error",t)}};w();const b=A.getRecordFromMap({sId:i.sId,foId:i.foId}),T=(t,e)=>{const s={name:Ee,params:{foId:t,sId:i.sId}};A.addRecordToMap({foId:t,sId:i.sId},[...b,{path:s,text:e}]),ye.push(s)},x=()=>{B.value!==a.length+l.length?(a.forEach((t,e)=>{a[e]=!0}),l.forEach((t,e)=>{l[e]=!0})):(a.forEach((t,e)=>{a[e]=!1}),l.forEach((t,e)=>{l[e]=!1}))},U=()=>{a.forEach((t,e)=>{a[e]=!1}),l.forEach((t,e)=>{l[e]=!1})},$=t=>{ue(i.sId,t).then(e=>{e.data.code=="200"&&(h("info",e.data.msg),w())}).catch(e=>{console.log("createResource error",e)}).finally(()=>{m.show=!1})},P=t=>{console.log(t),de(i.sId,1,t).then(e=>{e.data.code=="200"&&(h("info",e.data.msg),w())}).catch(e=>{console.log("createFolder error",e)}).finally(()=>{m.show=!1})},V=()=>{h("error","web\u7AEF\u6682\u65F6\u4E0D\u652F\u6301\u4E0B\u8F7D\u529F\u80FD")},L=(t,e)=>{k("warning",{title:"\u786E\u5B9A\u5220\u9664\u5417",content:"10\u5929\u5185\u53EF\u4EE5\u4ECE\u56DE\u6536\u7AD9\u64A4\u9500",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{fe(t).then(s=>{f.splice(e,1),h("success",s.data.msg)}).catch(s=>{console.log("delete err",s)})}})},j=t=>{ie(n.id,t).then(e=>{f[n.order].foName=t,h("success",e.data.msg)}).catch(e=>{console.log("folderRename error",e)}).finally(()=>{n.show=!1})},q=()=>{h("error","web\u7AEF\u6682\u65F6\u4E0D\u652F\u6301\u4E0B\u8F7D")},z=t=>{he(n.id,t).then(e=>{p[n.order].fileName=t,h("success",e.data.msg)}).catch(e=>{console.log("fileRename error",e)}).finally(()=>{n.show=!1})},G=(t,e)=>{k("warning",{title:"\u786E\u5B9A\u5220\u9664\u5417",content:"10\u5929\u5185\u53EF\u4EE5\u4ECE\u56DE\u6536\u7AD9\u64A4\u9500",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{pe(t).then(s=>{p.splice(e,1),h("success",s.data.msg)}).catch(s=>{console.log("fileDelete err",s)})}})},H=t=>{k("warning",{title:"\u4E0A\u4F20\u63D0\u9192",content:"\u786E\u5B9A\u4E0A\u4F20?",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{const e=[];for(let s=0;s<t.length;s++)e.push(me(t[s],2,i.foId));Promise.all(e).then(s=>{h("success",s[0].data.msg),w()}).catch(s=>{console.log("Promise.all uploadFiles error",s)})}})},J=t=>{const[e,s]=Z(t);ee(i.sId,2,e,s).then(w)};return(t,e)=>{const s=v("router-link"),K=v("n-breadcrumb-item"),Q=v("n-breadcrumb"),W=v("svg-icon");return u(),E(y,null,[d("header",null,[d("div",Ie,[D(Q,{separator:">"},{default:C(()=>[(u(!0),E(y,null,N(O(b),(o,r)=>(u(),F(K,{key:r},{default:C(()=>[D(s,{to:o.path,class:De(["breadcrumb-route",[r===O(b).length-1?"active":"no-active"]])},{default:C(()=>[d("span",null,ve(o.text),1)]),_:2},1032,["to","class"])]),_:2},1024))),128))]),_:1})]),d("div",Re,[D(W,{className:"icon-sousuo",class:"search-icon",onClick:e[0]||(e[0]=o=>R.value=!0)}),D(oe,{type:"folder",onOnNewFolder:e[1]||(e[1]=()=>{m.type="f",m.show=!0}),onOnUploadFile:H,onOnUploadFolder:J})])]),d("main",null,[d("div",be,[d("div",Ce,[D(se,{show:a.length+l.length!==0,"all-count":f.length+p.length,"select-count":O(B),"handle-select":x},null,8,["show","all-count","select-count"])])]),d("div",Ne,[d("div",{class:"absolute",onClick:U},[d("div",Oe,[d("div",ke,[(u(!0),E(y,null,N(f,(o,r)=>(u(),F(X,M({key:o.foId},o,{"change-able":I.sId!==0,"has-select":a[r],"handle-select":()=>{a[r]=!a[r]},onClick:S=>T(o.foId,o.foName),onOnDownload:V,onOnDelete:S=>L(o.foId,r),onOnRename:()=>{n.show=!0,n.type="f",n.id=o.foId,n.initName=o.foName,n.order=r},onOnDetails:()=>{c.show=!0,c.id=o.foId,c.type="f",c.title=o.foName}}),null,16,["change-able","has-select","handle-select","onClick","onOnDelete","onOnRename","onOnDetails"]))),128)),(u(!0),E(y,null,N(p,(o,r)=>(u(),F(Y,M({key:o.fId},o,{"change-able":I.sId!==0,"has-select":l[r],"handle-select":()=>{l[r]=!l[r]},onOnDownload:q,onOnRename:()=>{n.show=!0,n.type="file",n.id=o.fId,n.initName=o.fileName,n.order=r},onOnDetails:()=>{c.show=!0,c.id=o.fId,c.type="file",c.title=o.fileName},onOnDelete:S=>G(o.fId,r)}),null,16,["change-able","has-select","handle-select","onOnRename","onOnDetails","onOnDelete"]))),128))])])])])]),m.show?(u(),F(ne,{key:0,type:m.type,"onUpdate:show":e[2]||(e[2]=o=>m.show=!1),onCreateResource:$,onCreateFolder:P},null,8,["type"])):_("",!0),c.show?(u(),F(ae,{key:1,id:c.id,type:c.type,title:c.title,"onUpdate:show":e[3]||(e[3]=o=>c.show=!1)},null,8,["id","type","title"])):_("",!0),n.show?(u(),F(le,{key:2,"init-name":n.initName,type:n.type,"onUpdate:show":e[4]||(e[4]=o=>n.show=!1),onFolderRename:j,onFileRename:z},null,8,["init-name","type"])):_("",!0),R.value?(u(),F(re,{key:3,"onUpdate:show":e[5]||(e[5]=o=>R.value=!1)})):_("",!0)],64)}}});const xe=_e(Ae,[["__scopeId","data-v-777a4d0d"]]);export{xe as default};
